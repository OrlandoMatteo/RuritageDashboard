/*!
 * Start Bootstrap - SB Admin 2 v4.1.0 (https://startbootstrap.com/template-overviews/sb-admin-2)
 * Copyright 2013-2020 Start Bootstrap
 * Licensed under MIT (https://github.com/BlackrockDigital/startbootstrap-sb-admin-2/blob/master/LICENSE)
 */

function add_video(){var e=L.marker([45,-75.621562],{icon:new L.Icon.Default}).addTo(main_map),t=L.AwesomeMarkers.icon({icon:"video",iconColor:"white",markerColor:"red",prefix:"fa",extraClasses:"fa-rotate-0"});e.setIcon(t);var n=L.popup({maxWidth:"300"});n.setContent('<video width="300" src="https://magmageopark.no/wp-content/uploads/2018/05/Magma-Webside-test2.mp4" type="video/mp4" controls></video>'),e.bindPopup(n)}function add3d(e){var t=L.marker([45,-75.621562],{icon:new L.Icon.Default}).addTo(main_map),n=L.popup().setContent('<iframe src="3D"></iframe>');t.bindPopup(n)}function toggleChallenges(){$("#challengesTable").toggle(),"show more"==$("#tabletoggler").html()?$("#tabletoggler").html("show less"):$("#tabletoggler").html("show more")}function descriptionToggle(){$("#residualdescr").toggle(),"\nshow less"==$("#expandedDescr").html()?$("#expandedDescr").html("... show more"):$("#expandedDescr").html("\nshow less")}function ecoToggle(){$("#residualEco").toggle(),"\nshow less"==$("#expandedEco").html()?$("#expandedEco").html("... show more"):$("#expandedEco").html("\nshow less")}function createPopup(e){var t=150,n="<span>"+e.Description.substr(0,t)+"</span>"+('<span id="residualdescr" style="display:none">'+e.Description.substr(t,e.Description.length)+"</span>")+'<a style="cursor: pointer; color:#93bf38" id="expandedDescr" onclick="descriptionToggle()">... show more</a>';if("RM"==e.Role){t=100;var a="<span>"+e.MainEconomicSector.substr(0,t)+"</span>",i='<span id="residualEco" style="display:none">'+e.MainEconomicSector.substr(t,e.MainEconomicSector.length)+"</span>";economic=a+i+'<a style="cursor: pointer; color:#93bf38" id="expandedEco" onclick="ecoToggle()">... show more</a>'}var o='<h4 id="title">'+e.Name+'</h4><h5 style="color:'+SIAColor2(e.SIA)+'">'+roleDict[e.Role]+'<img src="'+siaImage[e.SIA]+'" width="210" height="35"></h5> <br><font size="2"><div id="extra"><font size="2"><br><b>Description</b><p>'+n+'</p><hr class="customHR">';if("RM"==e.Role){for(var r in o+='<br><b style="cursor: pointer; color:#93bf38" onClick="viewPractices('+e.ID+')" ><u>View Best Practices</u></b><br>',o+="<br><b>Main Economic Sector</b><br>"+economic+"<br>",o+='<br><b>Challenges     </b><a style="cursor: pointer; color:#93bf38" id="tabletoggler" onClick="toggleChallenges()">show more</a><br><table id="challengesTable"  class="table" style="width:100%; display:none" >',toavoid=["Description","Role","Name","SIA","MainEconomicSector"],e)-1==toavoid.indexOf(r)&&(e[r]&&(row="<tr><th>"+r.toString()+"</th>",e[r].startsWith("YES")?row+='<td style="background-color:#f7b446">'+e[r]+"</td></tr>":row+="<td>"+e[r]+"</td></tr>"),o+=row);o+="</table></font></div>"}return o}function onEachEntity(t,n){id=t.properties.ID,role=t.properties.Role,n.bindTooltip(t.properties.RM_R_CODE),content=createPopup(t.properties),n.bindPopup(content,{autoPan:!0}),n.on("click",function(e){id=n.feature.properties.ID,role=t.properties.Role,main_map.eachLayer(function(e){e.feature&&e.feature.properties.Role&&e.feature.properties.ID==id&&(e.feature.properties.Role,role)})})}function RMStyle2(e,t){switch(e.properties.SIA){case"SustainableFoodProduction":var n=L.icon({iconUrl:"img/rm_food.png",iconSize:[23,27]});return L.marker(t,{icon:n,riseOnHover:!0});case"Pilgrimage":var a=L.icon({iconUrl:"img/rm_pilgrimage.png",iconSize:[23,27]});return L.marker(t,{icon:a,riseOnHover:!0});case"Migration":var i=L.icon({iconUrl:"img/rm_migration.png",iconSize:[23,27]});return L.marker(t,{icon:i,riseOnHover:!0});case"ArtAndFestival":var o=L.icon({iconUrl:"img/rm_artandfestival.png",iconSize:[23,27]});return L.marker(t,{icon:o,riseOnHover:!0});case"Resilience":var r=L.icon({iconUrl:"img/rm_resilience.png",iconSize:[23,27]});return L.marker(t,{icon:r,riseOnHover:!0});case"IntegratedLandscapeManagement":var s=L.icon({iconUrl:"img/rm_landscape.png",iconSize:[23,27]});return L.marker(t,{icon:s,riseOnHover:!0})}}function ReplicatorStyle2(e,t){switch(e.properties.SIA){case"SustainableFoodProduction":var n=L.icon({iconUrl:"img/r_food.png",iconSize:[23,27]});return L.marker(t,{icon:n,riseOnHover:!0});case"Pilgrimage":var a=L.icon({iconUrl:"img/r_pilgrimage.png",iconSize:[23,27]});return L.marker(t,{icon:a,riseOnHover:!0});case"Migration":var i=L.icon({iconUrl:"img/r_migration.png",iconSize:[23,27]});return L.marker(t,{icon:i,riseOnHover:!0});case"ArtAndFestival":var o=L.icon({iconUrl:"img/r_artandfestival.png",iconSize:[23,27]});return L.marker(t,{icon:o,riseOnHover:!0});case"Resilience":var r=L.icon({iconUrl:"img/r_resilience.png",iconSize:[23,27]});return L.marker(t,{icon:r,riseOnHover:!0});case"IntegratedLandscapeManagement":var s=L.icon({iconUrl:"img/r_landscape.png",iconSize:[23,27]});return L.marker(t,{icon:s,riseOnHover:!0})}}function updateMap(){var n=["RoleModel","Replicator"],e=[];if(document.getElementById("sias"))for(checkboxesSIA=document.getElementById("sias"),i=0;i<checkboxesSIA.children.length;i++)"checkbox"==checkboxesSIA.children[i].type&&checkboxesSIA.children[i].checked&&e.push(checkboxesSIA.children[i].value);$.ajax({method:"GET",url:"http://localhost:8000/querySIA",data:{Roles:JSON.stringify(n),SIAs:JSON.stringify(e)},dataType:"json",success:function(e){if(x=e,0==n.length)populateMap(x,n);else for(var t=0;t<n.length;t++)populateMap(x,n)}})}function initialMap(t){$.ajax({method:"GET",url:"/initialMap",data:{Role:JSON.stringify(t)},dataType:"json",success:function(e){x=e,populateMap(x,t)}})}function populateMap(e,t){main_map.eachLayer(function(e){e.feature&&("RM"!=e.feature.properties.Role&&"R"!=e.feature.properties.Role||main_map.removeLayer(e))}),roleModelsJson={type:"FeatureCollection",features:[]};for(var n=0;n<e.features.length;n++)"RM"==e.features[n].properties.Role&&roleModelsJson.features.push(e.features[n]);var a=L.geoJson(roleModelsJson,{pointToLayer:RMStyle2,onEachFeature:onEachEntity,pane:"RM"}).addTo(main_map);rmMarkers.addLayer(a),a.setStyle(function(e){return e.properties.style}),replicatorJson={type:"FeatureCollection",features:[]};for(var i=0;i<e.features.length;i++)"R"==e.features[i].properties.Role&&replicatorJson.features.push(e.features[i]);var o=L.geoJson(replicatorJson,{pointToLayer:ReplicatorStyle2,onEachFeature:onEachEntity,pane:"R"}).addTo(main_map);rMarkers.addLayer(o),o.setStyle(function(e){return e.properties.style})}function selectall(){for(checkboxes=document.getElementById("sias"),i=0;i<checkboxes.children.length;i++)"checkbox"==checkboxes.children[i].type&&(checkboxes.children[i].checked=!0);updateMap()}function onEachArea(e,t){id=t.feature.geometry.properties.RM_R_CODE,role=t.feature.geometry.properties.Role;var n="";main_map.eachLayer(function(e){e.feature&&e.feature.properties.Role&&e.feature.properties.RM_R_CODE==id&&e.feature.properties.Role==role&&(n=createPopup(e.feature.properties))}),t.bindPopup(n)}function drawArea(e){for(var t=0;t<e.data.length;t++){x=e.data[t];var n=L.geoJson(x,{onEachFeature:onEachArea,pane:"Areas"}).addTo(main_map);n.setStyle(function(e){switch(e.geometry.properties.SIA){case"Sustainable food production":case"Pilgrimage":case"Migration":case"Art and festival":case"Resilience":case"Landscape":return{color:"#f0b629"}}}),Areas.addLayer(n)}}function addRMArea(){$.ajax({method:"GET",url:"/RMAreas",dataType:"json",success:function(e){x=e,drawArea(x)}})}function addRArea(){$.ajax({method:"GET",url:"/RAreas",dataType:"json",success:function(e){x=e,drawArea(x)}})}function onEachPath(e,t){t.bindTooltip(e.properties.name,{sticky:!0})}function drawPaths(e){for(var t=0;t<e.data.length;t++){x=e.data[t];var n=L.geoJson(x,{onEachFeature:onEachPath,pane:"Paths"}).addTo(main_map);n.setStyle(function(e){return{color:"#472502",dashArray:"5 5"}}),Paths.addLayer(n)}}function addRMPath(){$.ajax({method:"GET",url:"/RMPath",dataType:"json",success:function(e){x=e,drawPaths(x)}})}function buildingSidebar(e){return content='<h4 id="title">'+e.NAME+'</h4> <br><font size="2"><div id="extra"><font size="2"><br><b>Description</b><p>'+e.BUI_DESCRI+"</p>",content=content+"<p><b>Additional Information</b><br>Type: "+e.BUI_TYP+"<br>Area: "+e.TOWN_NAME+"<br>Refers to :"+e.RM_R_CODE+"</p>",content}function BuildingStyle(e,t){var n=L.icon({iconUrl:"img/building.png",iconSize:[42,42]});return L.marker(t,{icon:n,riseOnHover:!0})}function placeBuildings(e){for(var t=0;t<e.features.length;t++){x=e.features[t];var n=L.geoJson(x,{pointToLayer:HistBuildingStyle,onEachFeature:onEachHistBuilding,pane:"Buildings"}).addTo(main_map);Buildings.addLayer(n)}}function addBuildings(){main_map.eachLayer(function(e){e.feature&&!e.feature.properties.Role&&"markerPane"==e.options.pane&&e.feature.geometry.properties.BUI_TYP&&main_map.removeLayer(e)});var e;e=buiSelector.selected(),bounds=main_map.getBounds();$.ajax({method:"GET",url:"/buildings",data:{bounds:JSON.stringify(bounds),bui_types:JSON.stringify(e)},dataType:"json",success:function(e){x=e,placeBuildings(x)}})}function townSidebar(e){return content='<h4 id="title">'+e.NAME+'</h4> <hr class="customHR"><br><font size="2"><div id="extra"><font size="2">'+e.DESCRIPTION+"<br><b>Notes</b><p>"+e.NOTES+"</p>",content}function TownStyle(e,t){var n=L.icon({iconUrl:"img/Town.png",iconSize:[42,42]});return L.marker(t,{icon:n,riseOnHover:!0})}function onEachTown(e,t){t.bindTooltip(e.properties.NAME);var n='<h4 id="title">'+e.properties.NAME+"</h4>"+'<br><font size="2"><div id="extra"><font size="2"><b>Description</b><p>';null!=e.properties.NOTES&&(n+=e.properties.NOTES),null!=e.properties.DESCRIPTION&&(n=n+"\n"+e.properties.DESCRIPTION),n+="</p>",t.bindPopup(n),t.on("click",function(e){var t=main_map.getZoom();t<12&&(t=12),main_map.setView(e.latlng,t),clickedTown&&clickedTown.setIcon(L.icon({iconUrl:"img/Town.png",iconSize:[42,42]}));e.target;e.target.setIcon(L.icon({iconUrl:"img/Town.png",iconSize:[60,60]})),clickedTown=e.target})}function placeTowns(e){for(var t=0;t<e.features.length;t++){x=e.features[t];var n=L.geoJson(x,{pointToLayer:TownStyle,onEachFeature:onEachTown,pane:"Towns"}).addTo(main_map);Towns.addLayer(n)}}function addTowns(){bounds=main_map.getBounds();$.ajax({method:"GET",url:"/towns",data:{bounds:JSON.stringify(bounds)},dataType:"json",success:function(e){x=e,placeTowns(x)}})}function SiteStyle(e,t){return L.marker(t,{riseOnHover:!0})}function onEachSite(e,t){t.bindTooltip("Site of interest");var n='<h4 id="title">'+e.properties.NAME+"</h4>",a="";a=e.properties.RM_R_CODE.includes("RM")?"Role Model":"Replicator";var i=n+' <hr class="customHR"><b style="color:'+rmRColor(e.properties.RM_R_CODE)+'">'+a+"-"+rmRDict[e.properties.RM_R_CODE]+'</b><font size="2"><div id="extra"><font size="2"><p>';null!=e.properties.NOTES&&null!=e.properties.NOTES&&(i+=e.properties.NOTES),null!=e.properties.CHAR_SIA&&null!=e.properties.CHAR_SIA&&(i=i+"<br>"+charDict[e.properties.CHAR_SIA]),null!=e.properties.NOTE2&&null!=e.properties.NOTE2&&(i=i+"<br>Note: "+e.properties.NOTE2),i=(i+="</p></div>").replace(/undefined/g,"Not available"),t.bindPopup(i),t.on("click",function(e){main_map.setView(e.target._latlngs[0][0]),clickedSite&&clickedSite.setStyle({weight:3});e.target;e.target.setStyle({weight:12}),clickedSite=e.target,clickedBuilding=null})}function placeSite(e){for(var t=0;t<e.features.length;t++){x=e.features[t];var n=L.geoJson(x,{onEachFeature:onEachSite,pane:"Sites"}).addTo(main_map);n.setStyle({color:"#fa3939"}),Sites.addLayer(n)}}function drawSites(e){for(var t=0;t<e.features.length;t++){x=e.features[t];var n=L.geoJson(x,{onEachFeature:onEachSite}).addTo(main_map);n.setStyle(function(e){switch(e.geometry.properties.SIA){case"Sustainable food production":return{color:"#29e12c"};case"Pilgrimage":return{color:"#633d03"};case"Migration":return{color:"#a8a8a8"};case"Art and festival":return{color:"#f0b629"};case"Resilience":return{color:"#c19c77"};case"Landscape":return{color:"#0d5c1e"}}}),Sites.addLayer(n)}}function addSites(){bounds=main_map.getBounds();$.ajax({method:"GET",url:"/sites",data:{bounds:JSON.stringify(bounds)},dataType:"json",success:function(e){x=e,placeSite(x)}})}function histBuildingSidebar(e){content="",name="",name=null!=e.O_NAME?e.O_NAME:null!=e.N_NAME?e.N_NAME:e.NAME,content=content+'<h4 id="title">'+name+"</h4>",null!=e.RM_R_IM1&&(imageNames=e.RM_R_IM1.split(","),content=content+'<img src="/images?RM_R_CODE='+e.RM_R_CODE+"&imageName="+e.RM_R_IM1+'" width=250px>'),content+='<hr class="customHR"><br><font size="2"><div id="extra"><font size="2">';var t="";return t=e.RM_R_CODE.includes("RM")?"Role Model":"Replicator",content=content+'<b style="color:'+rmRColor(e.RM_R_CODE)+'">'+t+"-"+rmRDict[e.RM_R_CODE]+"</b>",null!=e.BUI_DESCRI&&null!=e.BUI_DESCRI&&(content=content+"<p><b>Description</b><br>"+e.BUI_DESCRI+"<br>"),null==e.O_FUNCTION&&null==e.O_FUNCTION||(content=content+"<br>Original function: "+ofDict[e.O_FUNCTION]),null==e.N_FUNCTION&&null==e.N_FUNCTION||(content=content+"<br>New function: "+nfDict[e.N_FUNCTION]),null==e.BUI_TYP&&null==e.BUI_TYP||(content=content+"<br>Type: "+e.BUI_TYP),null==e.ACTIVITY&&null==e.ACTIVITY||(content=content+"<br>Activity: "+activityBuildDict[e.ACTIVITY]),null==e.NOTES&&null==e.NOTES||(content=content+"<br>Notes:"+e.NOTES),null==e.NOTE2&&null==e.NOTE2||(content=content+". "+e.NOTE2),content+="</p>",content=content.replace(/null/g,"Not available"),content=content.replace(/undefined/g,"Not available"),content}function onEachHistBuilding(e,t){var n=(e.properties.N_NAME,e.properties.BUI_DESCRI);n=histBuildingSidebar(e.properties),t.bindPopup(n),t.on("click",function(e){var t=main_map.getZoom();t<17&&(t=17),clickedBuilding&&clickedBuilding.setIcon(L.icon({iconUrl:"img/Buildings.png",iconSize:[42,42]}));e.target;e.target.setIcon(L.icon({iconUrl:"img/Buildings.png",iconSize:[60,60]})),clickedBuilding=e.target})}function HistBuildingStyle(e,t){var n=L.icon({iconUrl:"img/Buildings.png",iconSize:[42,42]});return L.marker(t,{icon:n,riseOnHover:!0})}function placeHistBuildings(e){for(var t=0;t<e.features.length;t++){x=e.features[t];var n=L.geoJson(x,{pointToLayer:HistBuildingStyle,onEachFeature:onEachHistBuilding,pane:"Buildings"}).addTo(main_map);Buildings.addLayer(n)}}function addHistBuildings(){var e;e=hbtSelector.selected();var t;t=sscSelector.selected();var n;n=tmSelector.selected();var a;a=tsSelector.selected();var i;i=rmotSelector.selected();var o;o=nfSelector.selected(),bounds=main_map.getBounds();$.ajax({method:"GET",url:"/histbuildings",data:{bounds:JSON.stringify(bounds),bui_types:JSON.stringify(e),sitSiaCo:JSON.stringify(t),tempMesi:JSON.stringify(n),tempSta:JSON.stringify(a),rehabMotiv:JSON.stringify(i),nFunction:JSON.stringify(o)},dataType:"json",success:function(e){x=e,placeHistBuildings(x)}})}function hideOnZoom(){main_map.getZoom()<10&&(zoomflag=0,main_map.eachLayer(function(e){e.feature&&(e.feature.properties.Role||"overlayPane"==e.options.pane||"Areas"==e.options.pane||(main_map.removeLayer(e),buildingsLayer=!1,siteLayer=!1,infraLayer=!1,tourismLayer=!1,infSiaLayer=!1,eventLayer=!1,townLayer=!1,naturaLayer=!1,infraLayer=!1,infraBuildLayer=!1,elemLayer=!1))})),6<main_map.getZoom()&&main_map.getZoom()<10?0==areaLayer&&(addRMArea(),addRArea(),areaLayer=!0):main_map.eachLayer(function(e){e.feature&&!e.feature.properties.Role&&("Paths"!=e.options.pane&&"overlayPane"!=e.options.pane||e.feature.geometry.properties.Role&&(landuseLayer=!1))}),10<=main_map.getZoom()?(0==townLayer&&$(".leaflet-control-layers-overlays > label:nth-child(16) > div:nth-child(1) > input:nth-child(1)")[0].checked&&(addTowns(),townLayer=!0),0==siteLayer&&$(".leaflet-control-layers-overlays > label:nth-child(7) > div:nth-child(1) > input:nth-child(1)")[0].checked&&(addSites(),siteLayer=!0),0==infSiaLayer&&$(".leaflet-control-layers-overlays > label:nth-child(5) > div:nth-child(1) > input:nth-child(1)")[0].checked&&(addInfSia(),infSiaLayer=!0),0==naturaLayer&&$(".leaflet-control-layers-overlays > label:nth-child(18) > div:nth-child(1) > input:nth-child(1)")[0].checked&&(addNatura2000(),naturaLayer=!0),0==openairLayer&&$(".leaflet-control-layers-overlays > label:nth-child(9) > div:nth-child(1) > input:nth-child(1)")[0].checked&&(addOpenAir(),openairLayer=!0),0==landuseLayer&&$(".leaflet-control-layers-overlays > label:nth-child(6) > div:nth-child(1) > input:nth-child(1)")[0].checked&&(addLandUse(),addRiskZone(),landuseLayer=!0),0==routeLayer&&$(".leaflet-control-layers-overlays > label:nth-child(11) > div:nth-child(1) > input:nth-child(1)")[0].checked&&(addRoute(),routeLayer=!0),0==changeLayer&&$(".leaflet-control-layers-overlays > label:nth-child(8) > div:nth-child(1) > input:nth-child(1)")[0].checked&&(addChange(),changeLayer=!0),createSlideShow()):($("#imageContainer")[0].style.display="none",$("#imageContainer").html(""),townLayer=!1,siteLayer=!1,eventLayer=!1,infraLayer=!1,infraBuildLayer=!1,buildingsLayer=!1,histbuildingsLayer=!1),16<=main_map.getZoom()&&main_map.eachLayer(function(e){e.feature&&"Point"!=e.feature.geometry.type&&"LandUse"==e.options.pane&&(main_map.removeLayer(e),landuseLayer=!1)}),14<=main_map.getZoom()&&(0==buildingsLayer&&$(".leaflet-control-layers-overlays > label:nth-child(12) > div:nth-child(1) > input:nth-child(1)")[0].checked&&(addBuildings(),addNearTown(),buildingsLayer=!0),0==histbuildingsLayer&&$(".leaflet-control-layers-overlays > label:nth-child(12) > div:nth-child(1) > input:nth-child(1)")[0].checked&&(addHistBuildings(),histbuildingsLayer=!0,$("#imageContainer").toggle()),0==eventLayer&&$(".leaflet-control-layers-overlays > label:nth-child(13) > div:nth-child(1) > input:nth-child(1)")[0].checked&&(addEvents(),eventLayer=!0),0==tourismLayer&&$(".leaflet-control-layers-overlays > label:nth-child(14) > div:nth-child(1) > input:nth-child(1)")[0].checked&&(addTourism(),tourismLayer=!0),0==elemLayer&&$(".leaflet-control-layers-overlays > label:nth-child(15) > div:nth-child(1) > input:nth-child(1)")[0].checked&&(addElemsOfDist(),elemLayer=!0),0==infraLayer&&$(".leaflet-control-layers-overlays > label:nth-child(10) > div:nth-child(1) > input:nth-child(1)")[0].checked&&(addInfrastr(),infraLayer=!0),0==infraBuildLayer&&$(".leaflet-control-layers-overlays > label:nth-child(17) > div:nth-child(1) > input:nth-child(1)")[0].checked&&(infraBuildLayer=!0,addInfrastrBuild()))}function hideOnMove(){11<=main_map.getZoom()&&(main_map.eachLayer(function(e){e.feature&&(e.feature.properties.Role||"markerPane"==e.options.pane&&main_map.removeLayer(e))}),addTowns(),addBuildings(),addHistBuildings(),createSlideShow())}function PalestinaStyle(e,t){var n=L.AwesomeMarkers.icon({icon:"landmark",iconColor:"black",markerColor:"white",prefix:"fa",extraClasses:"fa-rotate-0"});return L.marker(t,{icon:n,riseOnHover:!0})}function onEachPalestina(e,t){t.bindTooltip(e.properties.name),popup=L.popup({maxWidth:"300"}),popup.setContent('<img class="resize" src=img/'+e.properties.Photo+">"),t.bindPopup(popup)}function addPalestina(){$.ajax({method:"GET",url:"/palestina",dataType:"json",success:function(e){x=e;L.geoJson(x,{pointToLayer:PalestinaStyle,onEachFeature:onEachPalestina}).addTo(main_map)}})}function showTowns(){1==townLayer?(townLayer=!1,main_map.eachLayer(function(e){e.feature&&!e.feature.properties.Role&&"markerPane"==e.options.pane&&"img/town4.png"==e.options.icon.options.iconUrl&&main_map.removeLayer(e)})):(addTowns(),townLayer=!0)}function showSites(){1==siteLayer?(siteLayer=!1,main_map.eachLayer(function(e){e.feature&&!e.feature.properties.Role&&"markerPane"==e.options.pane&&e.feature.geometry.properties.CH_TYPE&&main_map.removeLayer(e)})):(addSites(),siteLayer=!0)}function showBuildings(){$("#buildings").toggle(),$("#allBui")[0].checked||(1==buildingsLayer?(buildingsLayer=!1,main_map.eachLayer(function(e){e.feature&&!e.feature.properties.Role&&"markerPane"==e.options.pane&&e.feature.geometry.properties.BUI_NAME&&main_map.removeLayer(e)})):(addBuildings(),buildingsLayer=!0))}function allBuiType(){for(checkboxes=document.getElementById("buildings"),i=0;i<checkboxes.children.length;i++)"checkbox"==checkboxes.children[i].type&&checkboxes.children[i].value&&(checkboxes.children[i].checked=$("#allBui")[0].checked);addBuildings()}function showHistBuildings(){$("#histbuildings").toggle()}function allHistBuiType(){for(checkboxes=document.getElementById("hbtlist"),i=0;i<checkboxes.children.length;i++)"checkbox"==checkboxes.children[i].type&&checkboxes.children[i].value&&(checkboxes.children[i].checked=$("#allHistBuiType")[0].checked);addHistBuildings()}function allHistBuiSsc(){for(checkboxes=document.getElementById("sitSiaCo"),i=0;i<checkboxes.children.length;i++)"checkbox"==checkboxes.children[i].type&&checkboxes.children[i].value&&(checkboxes.children[i].checked=$("#allHistBuiSsc")[0].checked);addHistBuildings()}function allHistBuiTm(){for(checkboxes=document.getElementById("tempMesi"),i=0;i<checkboxes.children.length;i++)"checkbox"==checkboxes.children[i].type&&checkboxes.children[i].value&&(checkboxes.children[i].checked=$("#allHistBuiTm")[0].checked);addHistBuildings()}function allHistBuiTs(){for(checkboxes=document.getElementById("tempSta"),i=0;i<checkboxes.children.length;i++)"checkbox"==checkboxes.children[i].type&&checkboxes.children[i].value&&(checkboxes.children[i].checked=$("#allHistBuiTs")[0].checked);addHistBuildings()}function allHistBuiRm(){for(checkboxes=document.getElementById("rehabMotiv"),i=0;i<checkboxes.children.length;i++)"checkbox"==checkboxes.children[i].type&&checkboxes.children[i].value&&(checkboxes.children[i].checked=$("#allHistBuiRm")[0].checked);addHistBuildings()}function allHistBuiNf(){for(checkboxes=document.getElementById("nFunction"),i=0;i<checkboxes.children.length;i++)"checkbox"==checkboxes.children[i].type&&checkboxes.children[i].value&&(checkboxes.children[i].checked=$("#allHistBuiNf")[0].checked);addHistBuildings()}function showActors(){$("#roles").toggle(),"rgb(62, 142, 65)"!=$("#rm_rDD")[0].style.backgroundColor?$("#rm_rDD")[0].style.backgroundColor="#3e8e41":$("#rm_rDD")[0].style.backgroundColor="#93bf38"}function showSIAs(){$("#sias").toggle()}function hideDescription(){$("#lateral").find("#extra").toggle()}function closeLateral(){$("#lateral").html("")}function createSlideShow(){bounds=main_map.getBounds()}function updateFlow(e){if($("#imageContainer").html(""),0!=e.images.length){photos=e.images,slideShow="";for(var t=0;t<photos.length;t++){var n='<div onClick="centerMap('+photos[t].coordinates[0]+","+photos[t].coordinates[1]+',17)" class="swiper-slide" style="width:300px"><img src="data:image/jpg;base64,'+photos[t].binary+'" height="150px margin-left: auto; margin-right: auto; display: block;"  title="'+photos[t].Name+'" /></div>';slideShow+=n}$("#imageContainer").html(slideShow),swiper.update()}}function showImages(){}function centerMap(e,t,n){center=L.latLng(t,e),main_map.setView(center,n),closeLateral()}function centerRM(e,t,n){center=L.latLng(t,e),main_map.setView(center,n),closeLateral(),"block"!=$("#digitalArchiveMenu")[0].style.display&&$("#digitalArchiveMenu").toggle()}function centerR(e,t,n){center=L.latLng(t,e),main_map.setView(center,n),closeLateral(),"block"!=$("#digitalArchiveMenu")[0].style.display&&$("#digitalArchiveMenu").toggle(),"block"!=$("#digitalNarrativesMenu")[0].style.display&&$("#digitalNarrativesMenu").toggle()}function SIAColor(e){switch(e.properties.SIA){case"SustainableFoodProduction":case"Sustainable Food Production":return"#93bf38";case"Pilgrimage":return"#633d03";case"Migration":return"#a8a8a8";case"ArtAndFestival":return"#f0b629";case"Resilience":return"#f07929";case"IntegratedLandscapeManagement":case"Integrated Landscape Management":return"#0d5c1e"}}function SIAColor2(e){switch(e){case"SustainableFoodProduction":case"Sustainable Food Production":return"#93bf38";case"Pilgrimage":return"#633d03";case"Migration":return"#a8a8a8";case"ArtAndFestival":return"#f0b629";case"Resilience":return"#f07929";case"IntegratedLandscapeManagement":case"Integrated Landscape Management":return"#0d5c1e"}}function rmRColor(e){switch(e){case"RM3":case"RM4":case"R2":return"#93bf38";case"RM1":case"RM2":case"R1":return"#633d03";case"RM5":case"RM6":case"R3":return"#a8a8a8";case"RM7":case"RM8":case"R4":return"#f0b629";case"RM9":case"RM10":case"R5":return"#f07929";case"RM11":case"RM12":case"RM12":case"R6":return"#0d5c1e"}}function viewPractices(e){$.ajax({method:"GET",url:"/queryBP",data:{RmID:JSON.stringify(e)},dataType:"json",success:function(e){x=e,modelActionTable(x)}})}function modelActionTable(e){table='<span class="close" onClick="closeModal()">&times;</span> <table class="table">             <thead>                 <tr>                    <td style="font-size:12px; font-weight:bold" rowspan = "2">Related SIA</td>      <td style="font-size:12px; font-weight:bold" rowspan = "2">Significant Crosscutting</td style="font-size:12px; font-weight:bold">                    <td style="font-size:12px; font-weight:bold" rowspan = "2">Replicability</td style="font-size:12px; font-weight:bold">                    <td style="font-size:12px; font-weight:bold" rowspan = "2">Key Resources</td style="font-size:12px; font-weight:bold">                    <td style="font-size:12px; font-weight:bold" colspan = "3">Challenges</td style="font-size:12px; font-weight:bold">                    <td style="font-size:12px; font-weight:bold" rowspan = "2">Drivers</td style="font-size:12px; font-weight:bold">                    <td style="font-size:12px; font-weight:bold" colspan = "3">Context</td style="font-size:12px; font-weight:bold">                    <td style="font-size:12px; font-weight:bold" colspan = "5">Capital transfer mechanism</td style="font-size:12px; font-weight:bold">                    <td style="font-size:12px; font-weight:bold" rowspan = "2">Knowledge building</td style="font-size:12px; font-weight:bold">                    <td style="font-size:12px; font-weight:bold" rowspan = "2">Barriers</td style="font-size:12px; font-weight:bold">                    <td style="font-size:12px; font-weight:bold" rowspan = "2">Co-benefits</td style="font-size:12px; font-weight:bold">                    <td style="font-size:12px; font-weight:bold" colspan = "3">Process</td style="font-size:12px; font-weight:bold">                    <td style="font-size:12px; font-weight:bold">Keywords</td style="font-size:12px">                </tr>                <tr>                    <td style="font-size:12px">Challenge</td>                    <td style="font-size:12px">Yes/partially</td>                    <td style="font-size:12px">Description</td>                    <td style="font-size:12px">Geography</td>                    <td style="font-size:12px">Main Economic Sector</td>                    <td style="font-size:12px">Size of influence</td>                    <td style="font-size:12px">Capitals</td>                    <td style="font-size:12px">Relevance</td>                    <td style="font-size:12px">Initial</td>                    <td style="font-size:12px">Developed</td>                    <td style="font-size:12px">Obtained</td>                    <td style="font-size:12px">Milestone</td>                    <td style="font-size:12px">Year</td>                    <td style="font-size:12px">Conceptual step</td>                </tr>            </thead><tbody></tbody>            </table>',x=e.data[0].Practices,header="<h4>"+e.data[0].Name+'<i class="fas fa-times xClose" onClick="closeModal()"></i></h4><h4 style="color:'+SIAColor2(e.data[0]["SIA NAME"])+'"> Role Model</h4><h4 style="color:'+SIAColor2(e.data[0]["SIA NAME"])+'"><img style="height:50px" src="'+siaImage[e.data[0]["SIA NAME"]]+'"></h4>',CrossCutting="<p><b>Significant Crosscutting</b><br>"+x["SIGNIFICANT CROSS-CUTTING"]+"</p>",Replicability='<p><b style="color:orange">Replicability     :     </b><b style="color:#ffdb1a">'+x.REPLICABILITY+"</b></p>",KeyResources="<p><b>Key Resources</b>";for(var t=0;t<x["KEY RESOURCES"].length;t++)KeyResources=+x["KEY RESOURCES"][t]+"&nbsp;";KeyResources+="</p>",Challenges='<p><table class="table table-hover"><thead class="table-info">    <tr>        <th style="font-weight:bold; font-size:18px" colspan = "3">Challenges</th>    </tr>    <tr>        <th class="table-primary">Challenge</th class="table-primary">        <th class="table-primary">Presence</th class="table-primary">        <th class="table-primary">Description</th class="table-primary">    </tr></thead><tbody>';for(t=0;t<x.CHALLENGES.length;t++)Challenges+="<tr>",Challenges+="<td>"+x.CHALLENGES[t].CHALLENGE+"</td>",Challenges+="<td>"+x.CHALLENGES[t]["YES/PARTIALLY"]+"</td>",Challenges+="<td>"+x.CHALLENGES[t].DESCRIPTION+"</td>",Challenges+="</tr>";Challenges+="</tbody></table></p>",Drivers="<p><b>Drivers</b>";for(t=0;t<x.DRIVERS.length;t++)Drivers=+x.DRIVERS[t]+"&nbsp;";Drivers+="</p>",CTM='<p><table class="table table-hover"><thead class="table-info">    <tr>        <th style="font-weight:bold; font-size:18px" colspan = "5">Capital Transfer Mechanism</th>    </tr>    <tr>        <th class="table-primary">Capitals</th>        <th class="table-primary">Relevance</th>        <th class="table-primary">Initial</th> <th class="table-primary">Developed</th> <th class="table-primary">Obtained</th>    </tr></thead><tbody>';for(t=0;t<x["CAPITAL TRANSFER MECHANISM"].length;t++)CTM+="<tr>",CTM+="<td>"+x["CAPITAL TRANSFER MECHANISM"][t].CAPITAL+"</td>",CTM+="<td>"+x["CAPITAL TRANSFER MECHANISM"][t].RELEVANCE+"</td>",CTM+="<td>"+x["CAPITAL TRANSFER MECHANISM"][t].INITIAL+"</td>",CTM+="<td>"+x["CAPITAL TRANSFER MECHANISM"][t].DEVELOPED+"</td>",CTM+="<td>"+x["CAPITAL TRANSFER MECHANISM"][t].OBTAINED+"</td>",CTM+="</tr>";CTM+="</tbody></table></p>",KnowledgeBuilding='<p><table class="table table-hover"><thead class="table-info">    <tr>        <th style="font-weight:bold; font-size:18px" colspan = "3">Knowledge building</th>    </tr> </thead><tbody>';for(t=0;t<x["KNOWLEDGE BUILDING"].length;t++)KnowledgeBuilding+="<tr><td>&#10004;</td><td>"+x["KNOWLEDGE BUILDING"][t]+"</td></tr> ";KnowledgeBuilding+="</tbody></table></p>",Barriers='<p><table class="table table-hover"><thead class="table-info">    <tr>        <th style="font-weight:bold; font-size:18px" colspan = "3">Barriers</th>    </tr> </thead><tbody>';for(t=0;t<x.BARRIERS.length;t++)Barriers+="<tr><td>&#10004;</td>",Barriers+="<td>"+x.BARRIERS[t]+"</td></tr>";Barriers+="</tbody></table></p>",CoBenefit='<p><table class="table table-hover"><thead class="table-info">    <tr>        <th style="font-weight:bold; font-size:18px" colspan = "3">Co-benefits</th>    </tr> </thead><tbody>';for(t=0;t<x["CO-BENEFITS"].length;t++)CoBenefit+="<tr><td>&#10004;</td>",CoBenefit+="<td>"+x["CO-BENEFITS"][t]+"</td></tr>";CoBenefit+="</tbody></table></p>",Process='<p><table class="table table-hover"><thead class="bg-warning">    <tr>        <th style="font-weight:bold; font-size:18px" colspan = "3">Process</th>    </tr>    <tr>        <th class="table-warning">Milestones</th>        <th class="table-warning">Years</th>        <th class="table-warning">Conceputal step</th>     </tr></thead><tbody>';for(t=0;t<x.PROCESS.length;t++)Process+="<tr>",Process+="<td>"+x.PROCESS[t].MILESTONE+"</td>",Process+="<td>"+x.PROCESS[t].YEAR+"</td>",Process+="<td>"+x.PROCESS[t]["CONCEPTUAL STEP"]+"</td>",Process+="</tr>";Process+="</tbody></table></p>",modalContent=header+Challenges+CTM+KnowledgeBuilding+Barriers+CoBenefit+Process+'<h4><i class="fas fa-times xClose" onClick="closeModal()"></i></h4>',modalContent=modalContent.replace(/undefined/g,""),$("#bpcontainer").html(modalContent),$("#bpModal")[0].style.display="block"}function closeModal(){$("#bpModal")[0].style.display="none"}function sitStatusTranslate(e){switch(e){case"P":return"Planned";case"C":return"Contintuing";case"H":return"Historical";case"R":return"Recent";case"O":return"Other"}}function charSiaTranslate(e){switch(e){case"NA":return"Natural area";case"RA":return"Rural Area";case"UA":return"Unpopulated Area";case"HU":return"Historic Urban Center";case"GA":return"Area of Gentrification";case"IA":return"Area of Industrialization";case"RI":return"Area of Recent Industrialization";case"ND":return"Risk of Natral Disaster";case"O":return"Other"}}function hbtoggler(){$("#histchecks").toggle(),$(".js-example-basic-multiple").select2()}function selectColorChanger(e){"bold"==e.target.style.fontWeight?(e.target.style.backgroundColor="",e.target.style.fontWeight="normal",e.target.style.border="",e.target.style.borderRadius=""):(e.target.style.backgroundColor="#93bf38",e.target.style.fontWeight="bold",e.target.style.border="solid #688c1e",e.target.style.borderRadius="5px")}function focusRMR(t){main_map.eachLayer(function(e){e.feature&&(x=e.feature,x._id==t&&(main_map.setView(new L.LatLng(e._latlng.lat,e._latlng.lng),6),e.fireEvent("click")))})}function getImage(e,t){$.ajax({method:"GET",url:"/images",data:{imageName:e,RM_R_CODE:t},dataType:"json",success:function(e){x=e,placeSite(x)}})}function createFakeDropdown(){$.ajax({method:"GET",url:"/querySIA",data:{Roles:JSON.stringify(["RoleModel","Replicator"]),SIAs:JSON.stringify([])},dataType:"json",success:function(e){result=e;for(var t="",n="",a=0;a<result.features.length;a++)"RM"==result.features[a].properties.Role&&(t=t+'<a href="#" style="color: '+SIAColor(result.features[a])+'" >'+result.features[a].properties.Name+"</a>"),"R"==result.features[a].properties.Role&&(n=n+'<a href="#" style="color: '+SIAColor(result.features[a])+'">'+result.features[a].properties.Name+"</a>");$("#rmlist").html(t),$("#rlist").html(n)}})}